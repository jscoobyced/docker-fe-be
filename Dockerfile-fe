FROM node:latest AS build-env
WORKDIR /build

## Install dependencies packages
RUN set -ex; apt-get -qq update && apt-get -qq upgrade
RUN set -ex; apt-get install -qqy --no-install-recommends \
        ca-certificates apt-transport-https \
        software-properties-common dirmngr python

# Build application
COPY fe fe
RUN yarn --cwd fe install
RUN yarn --cwd fe build

# Deploy
FROM nginx:latest
WORKDIR /build

COPY --from=build-env /build/fe/dist /usr/share/nginx/html/
EXPOSE 80 443

